{"ast":null,"code":"/*\r\nimport dbConnect from '../../../lib/mongoose/dbConnect';\r\nimport Product from '../../../lib/mongoose/Product';\r\n\r\ndbConnect();\r\n*/\nimport { set } from 'js-cookie';\nimport { connectToDatabase } from '../../../lib/mongoose/dbCon';\nexport default (async (req, res) => {\n  const {\n    db\n  } = await connectToDatabase();\n  const {\n    method,\n    headers,\n    query\n  } = req;\n\n  switch (method) {\n    case 'GET':\n      try {\n        const response = await db.collection(headers.shopname + '.settings').findOne();\n        res.status(200).json({\n          success: true,\n          settings: response\n        });\n      } catch (error) {\n        res.status(400).json({\n          success: false\n        });\n      }\n\n      break;\n\n    case 'POST':\n      try {\n        if (req.body.settings._id) {\n          const response = await db.collection(headers.shopname + '.settings').update({\n            _id: req.body.settings._id\n          }, {\n            $set: {\n              priceRules: req.body.setting.priceRules\n            }\n          });\n          res.status(201).json({\n            success: true,\n            data: response\n          });\n        } else {\n          const response = await db.collection(headers.shopname + '.settings').insertOne(req.body);\n          res.status(201).json({\n            success: true,\n            data: response\n          });\n        }\n      } catch (error) {\n        res.status(400).json({\n          success: false,\n          error: error\n        });\n      }\n\n      break;\n\n    default:\n      res.status(400).json({\n        success: false\n      });\n      break;\n  }\n});","map":{"version":3,"sources":["E:/novostack/shopify/apps/ns-nextjs-shopify/pages/api/settings/index.js"],"names":["set","connectToDatabase","req","res","db","method","headers","query","response","collection","shopname","findOne","status","json","success","settings","error","body","_id","update","$set","priceRules","setting","data","insertOne"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AAEA,SAASA,GAAT,QAAoB,WAApB;AACA,SAAQC,iBAAR,QAAgC,6BAAhC;AAEA,gBAAe,OAAOC,GAAP,EAAWC,GAAX,KAAmB;AAC9B,QAAM;AAACC,IAAAA;AAAD,MAAO,MAAMH,iBAAiB,EAApC;AACA,QAAM;AAACI,IAAAA,MAAD;AAAQC,IAAAA,OAAR;AAAgBC,IAAAA;AAAhB,MAAyBL,GAA/B;;AACA,UAAOG,MAAP;AACI,SAAK,KAAL;AACI,UAAG;AACC,cAAMG,QAAQ,GAAG,MAAMJ,EAAE,CAACK,UAAH,CAAcH,OAAO,CAACI,QAAR,GAAiB,WAA/B,EAA4CC,OAA5C,EAAvB;AACAR,QAAAA,GAAG,CAACS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAACC,UAAAA,OAAO,EAAC,IAAT;AAAcC,UAAAA,QAAQ,EAACP;AAAvB,SAArB;AACH,OAHD,CAGC,OAAMQ,KAAN,EAAY;AACTb,QAAAA,GAAG,CAACS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAACC,UAAAA,OAAO,EAAC;AAAT,SAArB;AACH;;AACD;;AACJ,SAAK,MAAL;AAEI,UAAG;AACC,YAAGZ,GAAG,CAACe,IAAJ,CAASF,QAAT,CAAkBG,GAArB,EAAyB;AACrB,gBAAMV,QAAQ,GAAG,MAAMJ,EAAE,CAACK,UAAH,CAAcH,OAAO,CAACI,QAAR,GAAiB,WAA/B,EAA4CS,MAA5C,CACnB;AAACD,YAAAA,GAAG,EAAChB,GAAG,CAACe,IAAJ,CAASF,QAAT,CAAkBG;AAAvB,WADmB,EAEnB;AAACE,YAAAA,IAAI,EAAE;AAACC,cAAAA,UAAU,EAAEnB,GAAG,CAACe,IAAJ,CAASK,OAAT,CAAiBD;AAA9B;AAAP,WAFmB,CAAvB;AAIAlB,UAAAA,GAAG,CAACS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAACC,YAAAA,OAAO,EAAC,IAAT;AAAcS,YAAAA,IAAI,EAACf;AAAnB,WAArB;AACH,SAND,MAMK;AACD,gBAAMA,QAAQ,GAAG,MAAMJ,EAAE,CAACK,UAAH,CAAcH,OAAO,CAACI,QAAR,GAAiB,WAA/B,EAA4Cc,SAA5C,CAAsDtB,GAAG,CAACe,IAA1D,CAAvB;AACAd,UAAAA,GAAG,CAACS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAACC,YAAAA,OAAO,EAAC,IAAT;AAAcS,YAAAA,IAAI,EAACf;AAAnB,WAArB;AACH;AACJ,OAXD,CAWC,OAAMQ,KAAN,EAAY;AACTb,QAAAA,GAAG,CAACS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAACC,UAAAA,OAAO,EAAC,KAAT;AAAeE,UAAAA,KAAK,EAACA;AAArB,SAArB;AACH;;AACD;;AACJ;AACIb,MAAAA,GAAG,CAACS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAACC,QAAAA,OAAO,EAAC;AAAT,OAArB;AACA;AA5BR;AA8BH,CAjCD","sourcesContent":["/*\r\nimport dbConnect from '../../../lib/mongoose/dbConnect';\r\nimport Product from '../../../lib/mongoose/Product';\r\n\r\ndbConnect();\r\n*/\r\n\r\nimport { set } from 'js-cookie';\r\nimport {connectToDatabase} from '../../../lib/mongoose/dbCon';\r\n\r\nexport default async (req,res) => {\r\n    const {db} = await connectToDatabase();\r\n    const {method,headers,query} = req;\r\n    switch(method){\r\n        case 'GET':\r\n            try{      \r\n                const response = await db.collection(headers.shopname+'.settings').findOne()\r\n                res.status(200).json({success:true,settings:response})\r\n            }catch(error){\r\n                res.status(400).json({success:false})\r\n            }\r\n            break;\r\n        case 'POST':\r\n            \r\n            try{      \r\n                if(req.body.settings._id){          \r\n                    const response = await db.collection(headers.shopname+'.settings').update(\r\n                        {_id:req.body.settings._id},\r\n                        {$set: {priceRules: req.body.setting.priceRules}}\r\n                    )\r\n                    res.status(201).json({success:true,data:response})\r\n                }else{\r\n                    const response = await db.collection(headers.shopname+'.settings').insertOne(req.body)\r\n                    res.status(201).json({success:true,data:response})\r\n                }\r\n            }catch(error){\r\n                res.status(400).json({success:false,error:error})\r\n            }\r\n            break;\r\n        default:\r\n            res.status(400).json({success:false})\r\n            break;\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}